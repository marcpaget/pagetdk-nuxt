{"version":3,"file":"index.cjs","sources":["../src/SliceSimulator.ts"],"sourcesContent":["import Vue, { PropType, VNodeChildren } from \"vue\";\nimport { CreateElement, ExtendedVue } from \"vue/types/vue\";\n\nimport {\n\tgetDefaultProps,\n\tgetDefaultManagedState,\n\tgetDefaultSlices,\n\tgetDefaultMessage,\n\tonClickHandler,\n\tdisableEventHandler,\n\tsimulatorClass,\n\tsimulatorRootClass,\n\tSliceSimulatorState,\n\tSliceSimulatorOptions,\n\tSliceSimulatorProps as _SliceSimulatorProps,\n\tStateManagerEventType,\n\tStateManagerStatus,\n\tCoreManager,\n} from \"@prismicio/slice-simulator-core\";\n\nexport type SliceSimulatorProps = _SliceSimulatorProps;\n\nconst coreManager = new CoreManager();\n\nexport const SliceSimulator = {\n\tname: \"SliceSimulator\",\n\tprops: {\n\t\tstate: {\n\t\t\ttype: [Function, Object] as PropType<SliceSimulatorProps[\"state\"]>,\n\t\t\tdefault: () => getDefaultProps().state,\n\t\t\trequired: false,\n\t\t},\n\t\tzIndex: {\n\t\t\ttype: Number as PropType<Required<SliceSimulatorProps[\"zIndex\"]>>,\n\t\t\tdefault: getDefaultProps().zIndex,\n\t\t\trequired: false,\n\t\t},\n\t\tbackground: {\n\t\t\ttype: String as PropType<Required<SliceSimulatorProps[\"background\"]>>,\n\t\t\tdefault: getDefaultProps().background,\n\t\t\trequired: false,\n\t\t},\n\t},\n\tdata() {\n\t\treturn {\n\t\t\tcoreManager,\n\t\t\tmanagedState: getDefaultManagedState(),\n\t\t\tslices: getDefaultSlices(),\n\t\t\tmessage: getDefaultMessage(),\n\t\t};\n\t},\n\tmounted(this: SliceSimulatorOptions) {\n\t\tthis.coreManager.stateManager.on(\n\t\t\tStateManagerEventType.ManagedState,\n\t\t\t(managedState) => {\n\t\t\t\tthis.managedState = managedState;\n\t\t\t},\n\t\t\t\"simulator-managed-state\",\n\t\t);\n\t\tthis.coreManager.stateManager.on(\n\t\t\tStateManagerEventType.Slices,\n\t\t\t(slices) => {\n\t\t\t\tthis.slices = slices;\n\t\t\t},\n\t\t\t\"simulator-slices\",\n\t\t);\n\t\tthis.coreManager.stateManager.on(\n\t\t\tStateManagerEventType.Message,\n\t\t\t(message) => {\n\t\t\t\tthis.message = message;\n\t\t\t},\n\t\t\t\"simulator-message\",\n\t\t);\n\n\t\tthis.coreManager.init(this.state);\n\t},\n\twatch: {\n\t\t// Update state on HMR\n\t\tstate(this: SliceSimulatorOptions) {\n\t\t\tthis.coreManager.stateManager.reload(this.state);\n\t\t},\n\t},\n\tdestroyed(this: SliceSimulatorOptions) {\n\t\tthis.coreManager.stateManager.off(\n\t\t\tStateManagerEventType.ManagedState,\n\t\t\t\"simulator-managed-state\",\n\t\t);\n\t\tthis.coreManager.stateManager.off(\n\t\t\tStateManagerEventType.Slices,\n\t\t\t\"simulator-slices\",\n\t\t);\n\t\tthis.coreManager.stateManager.off(\n\t\t\tStateManagerEventType.Message,\n\t\t\t\"simulator-message\",\n\t\t);\n\t},\n\trender(this: SliceSimulatorOptions & Vue, h: CreateElement) {\n\t\tconst children: VNodeChildren = [];\n\n\t\tif (this.message) {\n\t\t\tchildren.push(\n\t\t\t\th(\"article\", {\n\t\t\t\t\tdomProps: {\n\t\t\t\t\t\tinnerHTML: this.message,\n\t\t\t\t\t},\n\t\t\t\t}),\n\t\t\t);\n\t\t} else if (this.slices.length && this.$scopedSlots.default) {\n\t\t\tchildren.push(\n\t\t\t\th(\n\t\t\t\t\t\"div\",\n\t\t\t\t\t{\n\t\t\t\t\t\tattrs: { id: \"root\" },\n\t\t\t\t\t\tclass: simulatorRootClass,\n\t\t\t\t\t\tstyle:\n\t\t\t\t\t\t\tthis.managedState.status !== StateManagerStatus.Loaded\n\t\t\t\t\t\t\t\t? { display: \"none\" }\n\t\t\t\t\t\t\t\t: undefined,\n\t\t\t\t\t\ton: {\n\t\t\t\t\t\t\t\"!click\": onClickHandler,\n\t\t\t\t\t\t\t\"!submit\": disableEventHandler,\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t\t[\n\t\t\t\t\t\tthis.$scopedSlots.default({\n\t\t\t\t\t\t\tslices: this.slices,\n\t\t\t\t\t\t}),\n\t\t\t\t\t],\n\t\t\t\t),\n\t\t\t);\n\t\t}\n\n\t\treturn h(\n\t\t\t\"div\",\n\t\t\t{\n\t\t\t\tclass: simulatorClass,\n\t\t\t\tstyle: {\n\t\t\t\t\tzIndex: this.zIndex,\n\t\t\t\t\tposition: \"fixed\",\n\t\t\t\t\ttop: 0,\n\t\t\t\t\tleft: 0,\n\t\t\t\t\twidth: \"100%\",\n\t\t\t\t\theight: \"100vh\",\n\t\t\t\t\toverflow: \"auto\",\n\t\t\t\t\tbackground: this.background,\n\t\t\t\t},\n\t\t\t},\n\t\t\tchildren,\n\t\t);\n\t},\n\t// This is some weird ass trick to get around `Vue.extend` messing up `this` context, don't do this at home kids\n} as unknown as ExtendedVue<\n\tVue,\n\tSliceSimulatorState,\n\tRecord<string, never>,\n\tRecord<string, never>,\n\tSliceSimulatorProps,\n\tvoid\n>;\n"],"names":["CoreManager","getDefaultProps","getDefaultManagedState","getDefaultSlices","getDefaultMessage","StateManagerEventType","simulatorRootClass","StateManagerStatus","onClickHandler","disableEventHandler","simulatorClass"],"mappings":"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"}
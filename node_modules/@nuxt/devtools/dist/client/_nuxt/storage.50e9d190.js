import{_ as re}from"./NIconButton.vue.43ec44ac.js";import{_ as le}from"./NSelect.vue.9f52b6f9.js";import{_ as ue}from"./NTextInput.vue.361fd6cd.js";import{a as G,o as r,c as m,w as l,L as ie,a3 as H,Z as de,u as t,aj as O,ao as ce,X as pe,C as I,m as j,aa as P,ah as R,a8 as me,T as _e,a7 as fe,e as ye,z as _,ap as T,f as u,i as c,h as p,D as L,t as g,F as x,K as U,l as d,A as z,aA as q,y as E,aF as ve,aG as ge,aP as he,au as ke,H as be,k as xe,ac as we}from"./entry.902f663c.js";import{_ as Ce}from"./NPanelGrids.0426d51d.js";import{_ as Ke}from"./PanelLeftRight.vue.583d184f.js";import{_ as Ne}from"./FilepathItem.vue.b3314ab3.js";import"./editor.ff73b8b7.js";const Ve=G({__name:"NLink",props:{to:null,href:null,target:null},setup(w){return(i,v)=>(r(),m(de(w.href||w.target?"a":t(O)),H(i.$props,{class:"n-link hover:n-link-hover n-transition n-link-base"}),{default:l(()=>[ie(i.$slots,"default")]),_:3},16))}}),$e={class:"h-[48px] flex items-center justify-between gap1 px-3"},Se={class:"w-full text-sm"},Ie=["value"],je=u("div",{"x-divider":""},null,-1),Le={key:0,"h-full":"","of-hidden":"",flex:"~ col"},Ue={border:"b base",class:"h-[49px] flex flex-none items-center justify-between px-4 text-sm"},qe={class:"flex items-center gap-4"},De={key:1},Ae=["onKeyup"],Be=u("br",null,null,-1),Me={key:0,op50:""},Fe={key:1},Pe=u("code",null,"nitro.storage",-1),Re=u("br",null,null,-1),Te={"font-bold":""},ze=u("br",null,null,-1),Ee={"text-sm":""},Ge=u("br",null,null,-1),tt=G({__name:"storage",async setup(w){let i,v;const W=ce(),h=pe(),k=I(""),y=I(""),a=j({get(){return P().query?.storage},set(n){h.replace({query:{storage:n}})}}),e=I(),b=j(()=>P().query?.key),{data:C}=([i,v]=R(()=>T("storageMounts",()=>_.getStorageMounts())),i=await i,v(),i),{data:K,refresh:D}=([i,v]=R(async()=>T("storageKeys",async()=>a.value?await _.getStorageKeys(a.value):[])),i=await i,v(),i),X=W.hook("storage:key:update",async(n,s)=>{if(!(!a.value||n.split(":")[0]!==a.value)&&(await D(),b.value===n)){if(s==="remove")return h.replace({query:{storage:a.value}});await V(b.value)}});me(X),_e(a,D),fe(async()=>{if(!b.value){e.value=null;return}V(b.value)}),ye("keydown",n=>{n.key==="s"&&(n.ctrlKey||n.metaKey)&&($(),n.preventDefault())});function N(n){return n.replace(`${a.value}:`,"")}const Z=j(()=>K.value?K.value.filter(n=>n.includes(k.value)):[]);async function V(n){const s=await _.getStorageItem(n);e.value={key:n,updatedKey:N(n),editingKey:!1,content:s,updatedContent:s}}async function J(){if(!y.value||!a.value)return;const n=`${a.value}:${y.value}`;K.value?.includes(n)||await _.setStorageItem(n,""),h.replace({query:{storage:a.value,key:n}}),y.value=""}async function $(){e.value&&(await _.setStorageItem(e.value.key,e.value.updatedContent),await V(e.value.key))}async function Q(){!e.value||!a.value||(await _.removeStorageItem(e.value.key),e.value=null)}async function Y(){if(!e.value||!a.value)return;const n=`${a.value}:${e.value.updatedKey}`;await _.setStorageItem(n,e.value.updatedContent),await _.removeStorageItem(e.value.key),h.replace({query:{storage:a.value,key:n}})}return(n,s)=>{const ee=re,te=le,S=ue,ne=O,oe=be,A=xe,B=Ve,M=we,F=Ce,ae=Ke,se=Ne;return t(a)?(r(),m(ae,{key:0,"storage-key":"tab-storage"},{left:l(()=>[u("div",$e,[c(ee,{icon:"carbon-chevron-left","ml--1":"",onClick:s[0]||(s[0]=o=>a.value="")}),u("div",Se,[c(te,{modelValue:t(a),"onUpdate:modelValue":s[1]||(s[1]=o=>U(a)?a.value=o:null),n:"primary",icon:"carbon-data-base"},{default:l(()=>[(r(!0),p(x,null,L(t(C),(o,f)=>(r(),p("option",{key:f,value:f},g(f),9,Ie))),128))]),_:1},8,["modelValue"])])]),c(S,{modelValue:t(k),"onUpdate:modelValue":s[2]||(s[2]=o=>U(k)?k.value=o:null),icon:"carbon-search",placeholder:"Search...",n:"primary sm",border:"y x-none base! rounded-0",class:"w-full py2 ring-0!"},null,8,["modelValue"]),(r(!0),p(x,null,L(t(Z),o=>(r(),p(x,{key:o},[c(ne,{block:"",truncate:"",px2:"",py1:"","font-mono":"","text-sm":"",to:{query:{key:o,storage:t(a)}},class:z(o===t(e)?.key?"text-primary n-bg-active":"text-secondary hover:n-bg-hover")},{default:l(()=>[d(g(N(o)),1)]),_:2},1032,["to","class"]),je],64))),128)),c(S,{modelValue:t(y),"onUpdate:modelValue":s[3]||(s[3]=o=>U(y)?y.value=o:null),icon:"carbon-add",placeholder:"key",n:"sm",border:"t-none x-none base! rounded-0",class:"w-full py2 font-mono ring-0!",onKeyup:q(J,["enter"])},null,8,["modelValue","onKeyup"])]),right:l(()=>[t(e)?.key?(r(),p("div",Le,[u("div",Ue,[u("div",qe,[t(e).editingKey?(r(),m(S,{key:0,modelValue:t(e).updatedKey,"onUpdate:modelValue":s[4]||(s[4]=o=>t(e).updatedKey=o),onKeyup:q(Y,["enter"])},null,8,["modelValue","onKeyup"])):(r(),p("code",De,[d(g(N(t(e).key))+" ",1),c(oe,{icon:"carbon-edit",class:"cursor-pointer op50 hover:op100",onClick:s[5]||(s[5]=o=>t(e).editingKey=!0)})])),t(e).editingKey?E("",!0):(r(),m(A,{key:2,n:"green xs",disabled:t(e).content===t(e).updatedContent,class:z({"border-green":t(e).content!==t(e).updatedContent}),onClick:$},{default:l(()=>[d(" Save ")]),_:1},8,["disabled","class"]))]),u("div",null,[c(A,{n:"red xs",onClick:Q},{default:l(()=>[d(" Delete ")]),_:1})])]),typeof t(e).content=="object"?(r(),m(t(ve),H({key:0,modelValue:t(e).updatedContent,"onUpdate:modelValue":s[6]||(s[6]=o=>t(e).updatedContent=o),class:[[n.$colorMode.value==="dark"?"jse-theme-dark":"light"],"json-editor-vue h-full of-auto text-sm outline-none"]},n.$attrs,{mode:"text","navigation-bar":!1,indentation:2,"tab-size":2}),null,16,["modelValue","class"])):ge((r(),p("textarea",{key:1,"onUpdate:modelValue":s[7]||(s[7]=o=>t(e).updatedContent=o),placeholder:"Item value...",class:"h-full of-auto p-4 font-mono text-sm outline-none",onKeyup:q(ke($,["ctrl"]),["enter"])},null,40,Ae)),[[he,t(e).updatedContent]])])):(r(),m(F,{key:1},{default:l(()=>[c(M,{px6:"",py4:""},{default:l(()=>[d(" Select one key to start."),Be,d("Learn more about "),c(B,{href:"https://nitro.unjs.io/guide/introduction/storage",n:"orange",target:"_blank"},{default:l(()=>[d(" Nitro storage ")]),_:1})]),_:1})]),_:1}))]),_:1})):(r(),m(F,{key:1},{default:l(()=>[Object.keys(t(C)).length?(r(),p("p",Me," Select one storage to start: ")):(r(),p("p",Fe,[d(" No custom storage defined in "),Pe,d("."),Re,d(" Learn more about "),c(B,{href:"https://nitro.unjs.io/guide/storage",n:"orange",target:"_blank"},{default:l(()=>[d(" Nitro storage ")]),_:1})])),(r(!0),p(x,null,L(t(C),(o,f)=>(r(),m(M,{key:f,"min-w-80":"","cursor-pointer":"","p-4":"","text-left":"",hover:"border-green",onClick:He=>a.value=f},{default:l(()=>[u("span",Te,g(f),1),ze,u("span",Ee,g(o.driver)+" driver",1),Ge,o.base?(r(),m(se,{key:0,"text-xs":"",filepath:o.base},null,8,["filepath"])):E("",!0)]),_:2},1032,["onClick"]))),128))]),_:1}))}}});export{tt as default};

import { withBase } from "ufo";
import { defineSatoriTransformer } from "../utils.mjs";
import { readPublicAssetBase64 } from "../../../utils.mjs";
export default defineSatoriTransformer((url) => {
  return {
    filter: (node) => node.type === "img",
    transform: async (node) => {
      const src = node.props?.src;
      if (src && src.startsWith("/")) {
        const file = await readPublicAssetBase64(src);
        if (file)
          node.props.src = file;
        else
          node.props.src = withBase(src, `${url.protocol}//${url.host}`);
      }
    }
  };
});

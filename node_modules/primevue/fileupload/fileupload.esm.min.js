import e from"primevue/button";import l from"primevue/icons/plus";import i from"primevue/icons/times";import t from"primevue/icons/upload";import s from"primevue/message";import o from"primevue/progressbar";import a from"primevue/ripple";import{DomHandler as n}from"primevue/utils";import d from"primevue/badge";import{resolveComponent as p,openBlock as r,createElementBlock as u,Fragment as c,renderList as h,createElementVNode as f,toDisplayString as m,createVNode as g,withCtx as v,createBlock as b,resolveDynamicComponent as y,normalizeClass as F,resolveDirective as B,renderSlot as C,withDirectives as L,normalizeStyle as I,withKeys as S,createCommentVNode as w,createTextVNode as k}from"vue";var $={emits:["remove"],props:{files:{type:Array,default:()=>[]},badgeSeverity:{type:String,default:"warning"},badgeValue:{type:String,default:null},previewWidth:{type:Number,default:50},templates:{type:null,default:null}},methods:{formatSize(e){if(0===e)return"0 B";let l=Math.floor(Math.log(e)/Math.log(1e3));return parseFloat((e/Math.pow(1e3,l)).toFixed(3))+" "+["B","KB","MB","GB","TB","PB","EB","ZB","YB"][l]}},components:{FileUploadButton:e,FileUploadBadge:d,TimesIcon:i}};const x=["alt","src","width"],E={class:"p-fileupload-file-details"},U={class:"p-fileupload-file-name"},D={class:"p-fileupload-file-size"},M={class:"p-fileupload-file-actions"};$.render=function(e,l,i,t,s,o){const a=p("FileUploadBadge"),n=p("TimesIcon"),d=p("FileUploadButton");return r(!0),u(c,null,h(i.files,((l,t)=>(r(),u("div",{key:l.name+l.type+l.size,class:"p-fileupload-file"},[f("img",{role:"presentation",class:"p-fileupload-file-thumbnail",alt:l.name,src:l.objectURL,width:i.previewWidth},null,8,x),f("div",E,[f("div",U,m(l.name),1),f("span",D,m(o.formatSize(l.size)),1),g(a,{value:i.badgeValue,class:"p-fileupload-file-badge",severity:i.badgeSeverity},null,8,["value","severity"])]),f("div",M,[g(d,{onClick:l=>e.$emit("remove",t),text:"",rounded:"",severity:"danger",class:"p-fileupload-file-remove"},{icon:v((e=>[i.templates.fileremoveicon?(r(),b(y(i.templates.fileremoveicon),{key:0,class:F(e.class),file:l,index:t},null,8,["class","file","index"])):(r(),b(n,{key:1,class:F(e.class),"aria-hidden":"true"},null,8,["class"]))])),_:2},1032,["onClick"])])])))),128)};var T={name:"FileUpload",emits:["select","uploader","before-upload","progress","upload","error","before-send","clear","remove","remove-uploaded-file"],props:{name:{type:String,default:null},url:{type:String,default:null},mode:{type:String,default:"advanced"},multiple:{type:Boolean,default:!1},accept:{type:String,default:null},disabled:{type:Boolean,default:!1},auto:{type:Boolean,default:!1},maxFileSize:{type:Number,default:null},invalidFileSizeMessage:{type:String,default:"{0}: Invalid file size, file size should be smaller than {1}."},invalidFileTypeMessage:{type:String,default:"{0}: Invalid file type, allowed file types: {1}."},fileLimit:{type:Number,default:null},invalidFileLimitMessage:{type:String,default:"Maximum number of files exceeded, limit is {0} at most."},withCredentials:{type:Boolean,default:!1},previewWidth:{type:Number,default:50},chooseLabel:{type:String,default:null},uploadLabel:{type:String,default:null},cancelLabel:{type:String,default:null},customUpload:{type:Boolean,default:!1},showUploadButton:{type:Boolean,default:!0},showCancelButton:{type:Boolean,default:!0},chooseIcon:{type:String,default:void 0},uploadIcon:{type:String,default:void 0},cancelIcon:{type:String,default:void 0},style:null,class:null},duplicateIEEvent:!1,data:()=>({uploadedFileCount:0,files:[],messages:[],focused:!1,progress:null,uploadedFiles:[]}),methods:{onFileSelect(e){if("drop"!==e.type&&this.isIE11()&&this.duplicateIEEvent)return void(this.duplicateIEEvent=!1);this.messages=[],this.files=this.files||[];let l=e.dataTransfer?e.dataTransfer.files:e.target.files;for(let e of l)this.isFileSelected(e)||this.validate(e)&&(this.isImage(e)&&(e.objectURL=window.URL.createObjectURL(e)),this.files.push(e));this.$emit("select",{originalEvent:e,files:this.files}),this.fileLimit&&this.checkFileLimit(),this.auto&&this.hasFiles&&!this.isFileLimitExceeded()&&this.upload(),"drop"!==e.type&&this.isIE11()?this.clearIEInput():this.clearInputElement()},choose(){this.$refs.fileInput.click()},upload(){if(this.customUpload)this.fileLimit&&(this.uploadedFileCount+=this.files.length),this.$emit("uploader",{files:this.files}),this.clear();else{let e=new XMLHttpRequest,l=new FormData;this.$emit("before-upload",{xhr:e,formData:l});for(let e of this.files)l.append(this.name,e,e.name);e.upload.addEventListener("progress",(e=>{e.lengthComputable&&(this.progress=Math.round(100*e.loaded/e.total)),this.$emit("progress",{originalEvent:e,progress:this.progress})})),e.onreadystatechange=()=>{4===e.readyState&&(this.progress=0,e.status>=200&&e.status<300?(this.fileLimit&&(this.uploadedFileCount+=this.files.length),this.$emit("upload",{xhr:e,files:this.files})):this.$emit("error",{xhr:e,files:this.files}),this.uploadedFiles.push(...this.files),this.clear())},e.open("POST",this.url,!0),this.$emit("before-send",{xhr:e,formData:l}),e.withCredentials=this.withCredentials,e.send(l)}},clear(){this.files=[],this.messages=null,this.$emit("clear"),this.isAdvanced&&this.clearInputElement()},onFocus(){this.focused=!0},onBlur(){this.focused=!1},isFileSelected(e){if(this.files&&this.files.length)for(let l of this.files)if(l.name+l.type+l.size===e.name+e.type+e.size)return!0;return!1},isIE11:()=>!!window.MSInputMethodContext&&!!document.documentMode,validate(e){return this.accept&&!this.isFileTypeValid(e)?(this.messages.push(this.invalidFileTypeMessage.replace("{0}",e.name).replace("{1}",this.accept)),!1):!(this.maxFileSize&&e.size>this.maxFileSize)||(this.messages.push(this.invalidFileSizeMessage.replace("{0}",e.name).replace("{1}",this.formatSize(this.maxFileSize))),!1)},isFileTypeValid(e){let l=this.accept.split(",").map((e=>e.trim()));for(let i of l){if(this.isWildcard(i)?this.getTypeClass(e.type)===this.getTypeClass(i):e.type==i||this.getFileExtension(e).toLowerCase()===i.toLowerCase())return!0}return!1},getTypeClass:e=>e.substring(0,e.indexOf("/")),isWildcard:e=>-1!==e.indexOf("*"),getFileExtension:e=>"."+e.name.split(".").pop(),isImage:e=>/^image\//.test(e.type),onDragEnter(e){this.disabled||(e.stopPropagation(),e.preventDefault())},onDragOver(e){this.disabled||(n.addClass(this.$refs.content,"p-fileupload-highlight"),e.stopPropagation(),e.preventDefault())},onDragLeave(){this.disabled||n.removeClass(this.$refs.content,"p-fileupload-highlight")},onDrop(e){if(!this.disabled){n.removeClass(this.$refs.content,"p-fileupload-highlight"),e.stopPropagation(),e.preventDefault();const l=e.dataTransfer?e.dataTransfer.files:e.target.files;(this.multiple||l&&1===l.length)&&this.onFileSelect(e)}},onBasicUploaderClick(){this.hasFiles?this.upload():this.$refs.fileInput.click()},remove(e){this.clearInputElement();let l=this.files.splice(e,1)[0];this.files=[...this.files],this.$emit("remove",{file:l,files:this.files})},removeUploadedFile(e){let l=this.uploadedFiles.splice(e,1)[0];this.uploadedFiles=[...this.uploadedFiles],this.$emit("remove-uploaded-file",{file:l,files:this.uploadedFiles})},clearInputElement(){this.$refs.fileInput.value=""},clearIEInput(){this.$refs.fileInput&&(this.duplicateIEEvent=!0,this.$refs.fileInput.value="")},formatSize(e){if(0===e)return"0 B";let l=Math.floor(Math.log(e)/Math.log(1e3));return parseFloat((e/Math.pow(1e3,l)).toFixed(3))+" "+["B","KB","MB","GB","TB","PB","EB","ZB","YB"][l]},isFileLimitExceeded(){return this.fileLimit&&this.fileLimit<=this.files.length+this.uploadedFileCount&&this.focused&&(this.focused=!1),this.fileLimit&&this.fileLimit<this.files.length+this.uploadedFileCount},checkFileLimit(){this.isFileLimitExceeded()&&this.messages.push(this.invalidFileLimitMessage.replace("{0}",this.fileLimit.toString()))},onMessageClose(){this.messages=null}},computed:{isAdvanced(){return"advanced"===this.mode},isBasic(){return"basic"===this.mode},advancedChooseButtonClass(){return["p-button p-component p-fileupload-choose",this.class,{"p-disabled":this.disabled,"p-focus":this.focused}]},basicChooseButtonClass(){return["p-button p-component p-fileupload-choose",this.class,{"p-fileupload-choose-selected":this.hasFiles,"p-disabled":this.disabled,"p-focus":this.focused}]},basicChooseButtonLabel(){return this.auto?this.chooseButtonLabel:this.hasFiles?this.files.map((e=>e.name)).join(", "):this.chooseButtonLabel},hasFiles(){return this.files&&this.files.length>0},hasUploadedFiles(){return this.uploadedFiles&&this.uploadedFiles.length>0},chooseDisabled(){return this.disabled||this.fileLimit&&this.fileLimit<=this.files.length+this.uploadedFileCount},uploadDisabled(){return this.disabled||!this.hasFiles||this.fileLimit&&this.fileLimit<this.files.length},cancelDisabled(){return this.disabled||!this.hasFiles},chooseButtonLabel(){return this.chooseLabel||this.$primevue.config.locale.choose},uploadButtonLabel(){return this.uploadLabel||this.$primevue.config.locale.upload},cancelButtonLabel(){return this.cancelLabel||this.$primevue.config.locale.cancel},completedLabel(){return this.$primevue.config.locale.completed},pendingLabel(){return this.$primevue.config.locale.pending}},components:{FileUploadButton:e,FileUploadProgressBar:o,FileUploadMessage:s,FileContent:$,PlusIcon:l,UploadIcon:t,TimesIcon:i},directives:{ripple:a}};const z={key:0,class:"p-fileupload p-fileupload-advanced p-component"},P=["multiple","accept","disabled"],W={class:"p-fileupload-buttonbar"},R={class:"p-button-label"},V={key:0,class:"p-fileupload-empty"},O={key:1,class:"p-fileupload p-fileupload-basic p-component"},N={class:"p-button-label"},A=["accept","disabled","multiple"];!function(e,l){void 0===l&&(l={});var i=l.insertAt;if(e&&"undefined"!=typeof document){var t=document.head||document.getElementsByTagName("head")[0],s=document.createElement("style");s.type="text/css","top"===i&&t.firstChild?t.insertBefore(s,t.firstChild):t.appendChild(s),s.styleSheet?s.styleSheet.cssText=e:s.appendChild(document.createTextNode(e))}}("\n.p-fileupload-content {\n    position: relative;\n}\n.p-fileupload-content .p-progressbar {\n    width: 100%;\n    position: absolute;\n    top: 0;\n    left: 0;\n}\n.p-button.p-fileupload-choose {\n    position: relative;\n    overflow: hidden;\n}\n.p-fileupload-buttonbar {\n    display: flex;\n    flex-wrap: wrap;\n}\n.p-fileupload > input[type='file'],\n.p-fileupload-basic input[type='file'] {\n    display: none;\n}\n.p-fluid .p-fileupload .p-button {\n    width: auto;\n}\n.p-fileupload-file {\n    display: flex;\n    flex-wrap: wrap;\n    align-items: center;\n}\n.p-fileupload-file-thumbnail {\n    flex-shrink: 0;\n}\n.p-fileupload-file-actions {\n    margin-left: auto;\n}\n"),T.render=function(e,l,i,t,s,o){const a=p("FileUploadButton"),n=p("FileUploadProgressBar"),d=p("FileUploadMessage"),$=p("FileContent"),x=B("ripple");return o.isAdvanced?(r(),u("div",z,[f("input",{ref:"fileInput",type:"file",onChange:l[0]||(l[0]=(...e)=>o.onFileSelect&&o.onFileSelect(...e)),multiple:i.multiple,accept:i.accept,disabled:o.chooseDisabled},null,40,P),f("div",W,[C(e.$slots,"header",{files:s.files,uploadedFiles:s.uploadedFiles,chooseCallback:o.choose,uploadCallback:o.upload,clearCallback:o.clear},(()=>[L((r(),u("span",{class:F(o.advancedChooseButtonClass),style:I(i.style),onClick:l[1]||(l[1]=(...e)=>o.choose&&o.choose(...e)),onKeydown:l[2]||(l[2]=S(((...e)=>o.choose&&o.choose(...e)),["enter"])),onFocus:l[3]||(l[3]=(...e)=>o.onFocus&&o.onFocus(...e)),onBlur:l[4]||(l[4]=(...e)=>o.onBlur&&o.onBlur(...e)),tabindex:"0"},[C(e.$slots,"chooseicon",{},(()=>[(r(),b(y(i.chooseIcon?"span":"PlusIcon"),{class:F(["p-button-icon p-button-icon-left",i.chooseIcon]),"aria-hidden":"true"},null,8,["class"]))])),f("span",R,m(o.chooseButtonLabel),1)],38)),[[x]]),i.showUploadButton?(r(),b(a,{key:0,label:o.uploadButtonLabel,onClick:o.upload,disabled:o.uploadDisabled},{icon:v((l=>[C(e.$slots,"uploadicon",{},(()=>[(r(),b(y(i.uploadIcon?"span":"UploadIcon"),{class:F([l.class,i.uploadIcon]),"aria-hidden":"true"},null,8,["class"]))]))])),_:3},8,["label","onClick","disabled"])):w("",!0),i.showCancelButton?(r(),b(a,{key:1,label:o.cancelButtonLabel,onClick:o.clear,disabled:o.cancelDisabled},{icon:v((l=>[C(e.$slots,"cancelicon",{},(()=>[(r(),b(y(i.cancelIcon?"span":"TimesIcon"),{class:F([l.class,i.cancelIcon]),"aria-hidden":"true"},null,8,["class"]))]))])),_:3},8,["label","onClick","disabled"])):w("",!0)]))]),f("div",{ref:"content",class:"p-fileupload-content",onDragenter:l[5]||(l[5]=(...e)=>o.onDragEnter&&o.onDragEnter(...e)),onDragover:l[6]||(l[6]=(...e)=>o.onDragOver&&o.onDragOver(...e)),onDragleave:l[7]||(l[7]=(...e)=>o.onDragLeave&&o.onDragLeave(...e)),onDrop:l[8]||(l[8]=(...e)=>o.onDrop&&o.onDrop(...e))},[C(e.$slots,"content",{files:s.files,uploadedFiles:s.uploadedFiles,removeUploadedFileCallback:o.removeUploadedFile,removeFileCallback:o.remove,progress:s.progress,messages:s.messages},(()=>[o.hasFiles?(r(),b(n,{key:0,value:s.progress,showValue:!1},null,8,["value"])):w("",!0),(r(!0),u(c,null,h(s.messages,(e=>(r(),b(d,{key:e,severity:"error",onClose:o.onMessageClose},{default:v((()=>[k(m(e),1)])),_:2},1032,["onClose"])))),128)),o.hasFiles?(r(),b($,{key:1,files:s.files,onRemove:o.remove,badgeValue:o.pendingLabel,previewWidth:i.previewWidth,templates:e.$slots},null,8,["files","onRemove","badgeValue","previewWidth","templates"])):w("",!0),g($,{files:s.uploadedFiles,onRemove:o.removeUploadedFile,badgeValue:o.completedLabel,badgeSeverity:"success",previewWidth:i.previewWidth,templates:e.$slots},null,8,["files","onRemove","badgeValue","previewWidth","templates"])])),!e.$slots.empty||o.hasFiles||o.hasUploadedFiles?w("",!0):(r(),u("div",V,[C(e.$slots,"empty")]))],544)])):o.isBasic?(r(),u("div",O,[(r(!0),u(c,null,h(s.messages,(e=>(r(),b(d,{key:e,severity:"error",onClose:o.onMessageClose},{default:v((()=>[k(m(e),1)])),_:2},1032,["onClose"])))),128)),L((r(),u("span",{class:F(o.basicChooseButtonClass),style:I(i.style),onMouseup:l[12]||(l[12]=(...e)=>o.onBasicUploaderClick&&o.onBasicUploaderClick(...e)),onKeydown:l[13]||(l[13]=S(((...e)=>o.choose&&o.choose(...e)),["enter"])),onFocus:l[14]||(l[14]=(...e)=>o.onFocus&&o.onFocus(...e)),onBlur:l[15]||(l[15]=(...e)=>o.onBlur&&o.onBlur(...e)),tabindex:"0"},[!o.hasFiles||i.auto?C(e.$slots,"uploadicon",{key:0},(()=>[(r(),b(y(i.uploadIcon?"span":"UploadIcon"),{class:F(["p-button-icon p-button-icon-left",i.uploadIcon]),"aria-hidden":"true"},null,8,["class"]))])):C(e.$slots,"chooseicon",{key:1},(()=>[(r(),b(y(i.chooseIcon?"span":"PlusIcon"),{class:F(["p-button-icon p-button-icon-left",i.chooseIcon]),"aria-hidden":"true"},null,8,["class"]))])),f("span",N,m(o.basicChooseButtonLabel),1),o.hasFiles?w("",!0):(r(),u("input",{key:2,ref:"fileInput",type:"file",accept:i.accept,disabled:i.disabled,multiple:i.multiple,onChange:l[9]||(l[9]=(...e)=>o.onFileSelect&&o.onFileSelect(...e)),onFocus:l[10]||(l[10]=(...e)=>o.onFocus&&o.onFocus(...e)),onBlur:l[11]||(l[11]=(...e)=>o.onBlur&&o.onBlur(...e))},null,40,A))],38)),[[x]])])):w("",!0)};export{T as default};

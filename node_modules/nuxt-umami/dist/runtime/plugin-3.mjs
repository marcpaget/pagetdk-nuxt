import { defineNuxtPlugin } from "#app";
import { loadScript, stripAttrs, useMock } from "./helpers.mjs";
export default defineNuxtPlugin(async (nuxtApp) => {
  const options = { ...nuxtApp.payload.config.public.umami };
  const { scriptUrl, enable, ...attrOpts } = options;
  const attrs = stripAttrs(attrOpts);
  const mockUmami = useMock(enable);
  let umami = mockUmami;
  if (enable && process.client) {
    await loadScript(scriptUrl, attrs).load().then((resolved) => {
      if (resolved !== false && window.umami) {
        umami = window.umami;
      }
    }).catch((err) => {
      console.error("An error occured, could not load Umami", err);
    });
  }
  return {
    provide: {
      umami
    }
  };
});

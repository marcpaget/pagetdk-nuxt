import { ref } from "vue";
import { getAllCookieIdsString, getCookieId } from "./methods.mjs";
import { defineNuxtPlugin, useCookie } from "#imports";
import moduleOptions from "#build/cookie-control-options";
export default defineNuxtPlugin((_nuxtApp) => {
  const cookieIsConsentGiven = useCookie(moduleOptions.cookieNameIsConsentGiven);
  const cookieCookiesEnabledIds = useCookie(
    moduleOptions.cookieNameCookiesEnabledIds
  ).value?.split("|");
  const isConsentGiven = ref(
    cookieIsConsentGiven === void 0 ? void 0 : cookieIsConsentGiven.value === getAllCookieIdsString(moduleOptions)
  );
  const cookiesEnabled = ref(
    cookieCookiesEnabledIds === void 0 ? void 0 : [
      ...moduleOptions.cookies.necessary.filter(
        (cookieNecessary) => cookieCookiesEnabledIds.includes(getCookieId(cookieNecessary))
      ),
      ...moduleOptions.cookies.optional.filter(
        (cookieOptional) => cookieCookiesEnabledIds.includes(getCookieId(cookieOptional))
      )
    ]
  );
  const cookiesEnabledIds = ref(cookieCookiesEnabledIds);
  const isModalActive = ref();
  const state = {
    isConsentGiven,
    cookiesEnabled,
    cookiesEnabledIds,
    isModalActive,
    moduleOptions
  };
  return {
    provide: {
      cookies: state
    }
  };
});
